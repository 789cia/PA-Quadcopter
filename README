########################################################################################################################################################
#
# mbh_arobotthatcanfly

这是一个开源的四轴飞行器控制项目，使用树莓派3b型做四轴飞行器的控制器，通过gpio引脚读取摇控器的输入pwm信号，计算mpu-6050陀螺仪的读数，然后对欧拉角和旋转角速度做平衡修正，最后通过gpio引脚并对四轴上的4个电调输出。

########################################################################################################################################################

免责声明：

	此四轴飞行控制程序没有任何商业性质和盈利目的，如在使用过程中出现意外事故，本程序的作者和开发社区并不承担任何责任。

########################################################################################################################################################

注意事项：

1、四轴飞行器不是玩具，在安装和使用时请一定要注意安全，并远离人群，确保自己和他人安全的情况下飞行。

2、在安装和调试四轴飞行器时不要为电动机安装螺旋桨，当程序调试成功并且摇控器校准成功之后，摇控器控制电机的转数，确认您可以正常操控电动机，并且确认电机转动完全正常之后，才可以根据实际情况安装螺旋桨。

########################################################################################################################################################

使用方法：

1、在安装四轴飞行器时mpu-6050陀螺仪正方向对准电机0,顺时针方向为电机0、电机1、电机2、电机3。

2、下载源代码，并拷贝到您的树莓派上，用网线连接到莓派上，并通过pc机ssh远程到树莓派上执行这些命令。

3、修改include/driver.h文件中摇控器接收机和电调的gpio引脚编号，编号是wiringPi的编号。

4、执行make命令，编译源代码。如果编译成功则成一个可执行文件“release/bin/quadcopter”。

5、执行su -c 'release/bin/quadcopter --test 15 0 3000'，测试您的gpio和电机，参数说明如下：
	--test [wringpi引脚编号] [电机运转速度0~1000] [测试时长0~30000毫秒]
	测试时需要让电机0和电机2转动方向为顺时针；电机1和电机3转动方向为逆时针。如果您的某一个电机不是按您想要的方向转动，仅需将电机的3根电源线的任意2根反接即可。
	
6、执行su -c 'release/bin/quadcopter --ctl'，显示并校准您摇控器的3个通道输入pwm信号时长。
	[bf: 1600 lr: 1600 pw: 1100] --> [bf: 1600 lr: 1600 pw: 1100]
	bf:表示“前/后”，也就是摇控器上控制“前/后”通道的数值，校准时“前/后”通道必须被调节到中心点。
	lr:表示“左/右”，也就是摇控器上控制“左/右”通道的数值，校准时“左/右”通道必须被调节到中心点。
	pw:表示“油门”，也就是摇控器上控制“油门”通道的数值，校准时“油门”通道必须被调节到最低。
	在调整完您满意的参数之后按“S”保存(Save的首字母)当前参数，按“L”载入(Load的首字母)上次保存的参数（注意按键的大小写）。
	
7、执行su -c 'release/bin/quadcopter --fly'开始飞行模式。这时您会看到这样的输出内容，按键q、w、e、r、t、y、u、i、o、p（注意按键的大小写）可以用于切换显示不同的参数：
	q : [pid: +12.00 +1.80 +8.00]——欧拉角pid参数
	w : [pid_v: +15.20 +10.60 +12.00]——角速度pid参数
	e : [pid_z: +3.60 +0.80 +2.80]——抑制自旋pid参数
	r : [pid_a: +38.60 +35.80 +30.00]——加速度pid参数
	t : [c_xy: +0.0 +0.0]——陀螺仪中心点校准补偿
	y : [ctl zero: 1408 1607 1009]——摇控器起始读数
	u : [xyz: +0.0 +0.0 +0.0]——xyz欧拉角
	i : [gxyz: +0.0 +0.0 +0.0]——xyz旋转角速度
	o : [axyz: +0.0 +0.0 +0.0]——xyz加速度
	p : [speed: +0.0 +0.0 +0.0 +0.0]——电动机实际转数（0～1000）
	处于不同的显示参数状态下，按下小键盘上的数字按钮可以对这些参数做相应的调整，其中7、8、9按键为增加参数值；4、5、6按键为减小参数值。例如：
	在当前显示欧拉角pid参数时，按“7”则对kp加0.1；按“4”则对kp减0.1；按“8”则对ki加0.1；按“5”则对ki减0.1；按“9”则对kd加0.1；按“6”则对kd减0.1。
	在调整完您满意的参数之后按“S”保存(Save的首字母)当前参数，按“L”载入(Load的首字母)上次保存的参数（注意按键的大小写）。

8、当程序运行时，电机处于锁定状态(停止转动)，不可以通过油门控制电机转动的快慢。
	将摇控器油门拉至最低，将方向拉至最左侧，并等待3秒以上时间，则电机解锁，此时可以通过摇控器油门控制转动。
	将摇控器油门拉至最低，将方向拉至最右侧，并等待3秒以上时间，则电机锁定(停止转动)，此时不可以通过摇控器油门控制转动。
	
9、在电机解锁时，摇控器的油门增加，电机加速；摇控器的油门减小，电机减速。

10、将油门拉至最低，关闭quadcopter飞行控制程序，关闭摇控器，将电机的电源断开，调试结束。
