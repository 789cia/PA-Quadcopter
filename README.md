# mbh_arobotthatcanfly
<br>
<br>这是一个开源的四轴飞行器控制项目，使用树莓派3b型做四轴飞行器的控制器，通过gpio引脚读取摇控器的输入pwm信号，计算mpu-6050陀螺仪的读数，然后对欧拉角和旋转角速度做平衡修正，最后通过gpio引脚并对四轴上的4个电调输出。
<br>注意：安装时，mpu-6050陀螺仪正方向对准电机0,从电机0开始依次顺时针为电机0、1、2、3。
<br>
<br>使用方法：
<br>
<br>1、下载源代码，并拷贝到你的树莓派上，用网线连接到莓派上，并通过pc机ssh远程到树莓派上执行这些命令。
<br>
<br>2、修改include/driver.h文件中摇控器接收机和电调的gpio引脚编号，编号是wiringpi的编号。
<br>
<br>3、修改include/dirver.h文件中摇控器pwm信号零点时长（不是必需的，你可以通过--ctl参数查看当前摇控器的读数）。
<br>
<br>4、执行make命令，编译源代码。如果编译成功话会生成一个可执行文件release/bin/quadcopter。
<br>
<br>5、执行su -c 'release/bin/quadcopter --test 15 100 3000'，测试你的gpio和电机，你的显示器会显示如下内容：
<br>	--test [wringpi引脚编号] [电机运转速度0~1000] [测试时长0~30000毫秒]
<br>	
<br>6、执行su -c 'release/bin/quadcopter --ctl'，显示你的摇控器3个通道输入pwm信号时长。
<br>	[bf: 1600 lr: 1600 pw: 1100]
<br>	bf:表示“前/后”，也就是摇控器上控制“前/后”通道的数值，你应该尽量让它接近1600，或者修改include/driver.h中的ctl_bf默认数值让它接近你的实际读数。
<br>	lr:表示“左/右”，也就是摇控器上控制“左/右”通道的数值，你应该尽量让它接近1600，或者修改include/driver.h中的ctl_lr默认数值让它接近你的实际读数。
<br>	pw:表示“油门”，也就是摇控器上控制“上下”通道的数值，你应该尽量让它接近1100，因为在开始时油门通常都会被调节到最低，或者修改include/driver.h中的ctl_pw默认数值让它接近你的实际读数。
<br>	
<br>7、执行su -c 'release/bin/quadcopter --fly'开始飞行模式。这时你会看到这样的输出内容：
<br>	[xyz:  +1.800 +2.000  +0.000][gxyz:  +0.000  +0.000  +0.000][s0:   0   0   0   0][c_xy: +0.0 +0.0]
<br>	从左到右分别为：[xyz轴欧拉角] [xyz轴角速度] [当前电机转数] [pid参数]。最后一列的值显示的是当前欧拉角的pid参数，而键盘上的4个按键q、w、e、r（注意按键的大小写）可以用于切换显示不同的参数：
<br>	q : [pid: +12.00 +1.80 +8.00]	——欧拉角pid参数
<br>	w : [pid_v: +15.20 +10.60 +12.00]	——角速度pid参数
<br>	e : [pid_z: +3.60 +0.80 +2.80]	——抑制自旋pid参数
<br>	r : [c_xy: +0.0 +0.0]		——陀螺仪中心点校准补偿
<br>	处于不同的显示参数状态下，按下小键盘上的数字按钮可以对这些参数做相应的调整，例如：
<br>	在pid参数调整下，按“7”则对kp加0.1；按“4”则对kp减0.1；按“8”则对ki加0.1；按“5”则对ki减0.1；按“9”则对kd加0.1；按“6”则对kd减0.1。
<br>	在pid_v参数调整下，按“7”则对kp_v加0.1；按“4”则对kp_v减0.1；按“8”则对ki_v加0.1；按“5”则对ki_v减0.1。按“9”则对kd_v加0.1；按“6”则对kd_v减0.1；
<br>	在pid_z参数调整下，按“7”则对kp_z加0.1；按“4”则对kp_z减0.1；按“8”则对ki_z加0.1；按“5”则对ki_z减0.1。按“9”则对kd_z加0.1；按“6”则对kd_z减0.1；
<br>	在c_xy参数调整下，按“7”则对cx加0.1；按“4”则对cx减0.1；按“8”则对cy加0.1；按“5”则对cy减0.1。
<br>	按“+”键则对所有电机的转数加10，按“-”键则对有电机的转数减10，按“0”电机停转（在电机转数为0时，不对电机做任何的平衡处理）。
<br>
<br>8、在调整完你满意的参数之后按“s”保存(save的首字母)当前参数，按“l”载入(load的首字母)上次保存的参数（注意按键的大小写）。
<br>
<br>9、如果拔掉树莓派上的网线（如果你插入了网线的话）。
<br>
<br>9、缓慢推动摇控器的油门起飞，四轴飞行器的螺旋桨逐渐加速，起飞。
<br>